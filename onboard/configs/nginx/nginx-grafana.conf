##
# Reverse proxy setup for Grafana

server {
	listen 80 default_server;
	listen [::]:80 default_server;

	server_name _;

	return 301 https://$host$request_uri;
}

server {
	# SSL configuration
	#
	listen 443 ssl default_server;
	listen [::]:443 ssl default_server;

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
 	    proxy_pass         http://127.0.0.1:3000/;
 	    proxy_http_version 1.1;
	    http2_push_preload on; # Enable http2 push

	    proxy_set_header   Host               $http_host;
	    proxy_set_header   X-Forwarded-Proto  $scheme;
	    proxy_set_header   X-Forwarded-Host   $http_host;
	    proxy_set_header   X-Forwarded-For    $remote_addr;
	    proxy_set_header   X-Real-IP          $remote_addr;

	    # optionally, you can adjust the POST request size limit, to allow adding a lot of torrents at once:
	    #client_max_body_size 100M;

	    # since v4.2.2, is possible to configure qBittorrent
	    # to set the "Secure" flag for the session cookie automatically.
	    # However, that option does nothing unless using qBittorrent's built-in HTTPS functionality.
	    # For this use case, where qBittorrent itself is using plain HTTP
	    # (and regardless of whether or not the external website uses HTTPS),
	    # the flag must be set here, in the proxy configuration itself:
	    proxy_cookie_path / "/; Secure";
	}

        ssl_certificate /etc/letsencrypt/live/graf.kg.lan/cert.pem;
        ssl_certificate_key /etc/letsencrypt/live/graf.kg.lan/privkey.pem;
        ssl_trusted_certificate /etc/letsencrypt/live/graf.kg.lan/chain.pem;
}


