# _____________________________________________________________________________
- name: Setup telegraf
  hosts: autismsequel
  become: true
  tasks:
    - name: Copy common telegraf configs
      ansible.builtin.copy:
        src: configs/telegraf/autismsequel.conf
        dest: /etc/telegraf/telegraf.d/autismsequel.conf
        owner: telegraf
        group: telegraf
        mode: "600"
      notify:
        - Restart telegraf

  handlers:
    - name: Restart telegraf
      ansible.builtin.systemd:
        name: telegraf
        state: restarted
# # _____________________________________________________________________________
# - name: Duckdns Setup
#   hosts: ent
#   become: true
#   collections:
#     - community.general
#   tasks:
#     # Duckdns
#     - name: Create a /opt/duckdns if it does not exist
#       ansible.builtin.file:
#         path: /opt/duckdns/
#         state: directory
#         mode: '0755'

#     - name: Copy duck cron job
#       ansible.builtin.copy:
#         src: scripts_cron/duck.sh
#         dest: /opt/duckdns/duck.sh
#         owner: root
#         group: root
#         mode: '0774'

#     - name: Set duckdns cron job
#       ansible.builtin.cron:
#         name: 'Update duckdns'
#         minute: '20'
#         job: '/opt/duckdns/duck.sh'

#     - name: Create ducktoken file
#       ansible.builtin.copy:
#         dest: '/opt/duckdns/ducktoken'
#         mode: '0600'
#         owner: root
#         group: root
#         content: '{{ secret_duckdns }}'

#     - name: Setup telegraf conf
#       ansible.builtin.lineinfile:
#         path: /opt/duckdns/duck.sh
#         regexp: 'domain='
#         line: 'domain=autismfactory"'
#         state: present
#       notify:
#         - Restart telegraf
