---

# useradd ansible_svc
# usermod -a -G wheel ansible_svc || usermod -a -G sudo ansible_svc
# wget https://gist.githubusercontent.com/kism/b2ee231284df52cfb66814bfa3d79fa0/raw/0de066bd763d0712d1410cb4f4f518b9dd6ddecc/gistfile1.txt -O /home/ansible_svc/.ssh/authorized_keys || curl https://gist.githubusercontent.com/kism/b2ee231284df52cfb66814bfa3d79fa0/raw/0de066bd763d0712d1410cb4f4f518b9dd6ddecc/gistfile1.txt -o /home/ansible_svc/.ssh/authorized_keys
# chown -R ansible_svc:ansible_svc /home/ansible_svc
# chmod 600 /home/ansible_svc/authorized_keys

- name: Add the user 'kism' with a bash shell, appending the group 'admins' and 'developers' to the user's groups
  ansible.builtin.user:
    name: kism
    shell: /bin/bash
    groups: sudo
    append: yes

- name: Set authorized keys taken from url using lookup
  hosts: all
  ansible.posix.authorized_key:
    user: kism
    state: present
    key: "{{ lookup('url', 'https://github.com/kism.keys', split_lines=False) }}"

- name: Ensure group "kgadmins" exists
  ansible.builtin.group:
    name: kgadmins
    state: present

- name: adding existing user '{{ kism }}' to group sudo
  user:
    name: '{{ kism }}'
    groups: sudo, wheel
    append: yes


  # - name: Disable root Login
  #   lineinfile:
  #         dest: /etc/ssh/sshd_config
  #         regexp: '^PermitRootLogin'
  #         line: "PermitRootLogin no"
  #         state: present
  #         backup: yes
  #   become: yes
  #   notify:
  #     - restart ssh

  # handlers:
  # - name: restart ssh
  #   systemctl:
  #     name: sshd
  #     state: restarted