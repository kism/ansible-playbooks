---
- name: Add user accounts
  ansible.builtin.user:
    name: "{{ item.key }}"
    uid: "{{ item.value.uid }}"
    shell: "{{ item.value.shell }}" # These could be an issue depending on install location
    create_home: false
    append: false
  with_dict: "{{ configure_users_users }}"

- name: Set passwords for login accounts
  ansible.builtin.user:
    name: "{{ item.key }}"
    password: "{{ item.value }}"
    create_home: true
  with_dict:
    kism: "{{ secret_myuser_password_hash }}"
    root: "{{ secret_root_password_hash }}"

- name: Set authorized keys for {{ configure_users_myuser }}
  ansible.posix.authorized_key:
    user: "{{ configure_users_myuser.linux_username }}"
    state: present
    exclusive: true
    key: "{{ lookup('url', configure_users_myuser.ssh_keys_url, split_lines=False) }}"
