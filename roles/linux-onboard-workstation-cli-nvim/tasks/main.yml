- name: Copy nvim settings
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "~/"
    owner: "{{ service_account }}"
    mode: "0660"
  loop:
    - files/.config
    - files/.local
  become: true
  become_user: "{{ service_account }}"

- name: Download and setup plug
  ansible.builtin.get_url:
    url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    dest: ~/.local/share/nvim/site/autoload/plug.vim
    mode: "0600"
  become: true
  become_user: "{{ service_account }}"

- name: Install plug plugins
  ansible.builtin.command:
    cmd: "nvim --headless +PlugInstall +qa"
  changed_when: true
  become: true
  become_user: "{{ service_account }}"