# _____________________________________________________________________________
- name: Setup Adoptium
  hosts: gameserver
  become: true
  tasks:
    - name: Copy file with owner and permission, using symbolic representation
      ansible.builtin.copy:
        src: repos_dnf/adoptium.repo
        dest: /etc/yum.repos.d/adoptium.repo
        owner: root
        group: root
        mode: "0664"

    - name: Import Adoptium GPG key
      ansible.builtin.rpm_key:
        state: present
        key: https://packages.adoptium.net/artifactory/api/gpg/key/public

    - name: Install Adoptium
      ansible.builtin.dnf:
        name: temurin-19-jdk
        state: present

# _____________________________________________________________________________
- name: Setup Minecraft Firewall
  hosts: gameserver
  become: true
  tasks:
    - name: Allow Minecraft through firewalld
      ansible.posix.firewalld:
        service: minecraft
        zone: public
        permanent: true
        state: enabled
      notify:
        - Restart firewalld

  handlers:
    - name: Restart firewalld
      ansible.builtin.systemd:
        name: firewalld
        state: restarted

# _____________________________________________________________________________
- name: Setup Minecraft Folders
  hosts: gameserver
  become: true
  tasks:
    - name: Create minecraft directories
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
        mode: "0770"
      loop:
        - /opt/minecraft

    - name: Recursively change ownership of a directory
      ansible.builtin.file:
        path: /opt/minecraft
        state: directory
        recurse: true
        owner: minecraft
        group: minecraft

# _____________________________________________________________________________
- name: Reminders
  hosts: gameserver
  tasks:
    - name: Reminder
      ansible.builtin.debug:
        msg: "Install your favorite minecraft server to /opt/minecraft"
