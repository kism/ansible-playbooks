---
- name: Add my favorite /opt subdirectory
  ansible.builtin.file:
    path: /opt/scripts
    state: directory
    mode: "0775"

- name: Check if kdump is installed
  ansible.builtin.stat:
    path: /etc/init.d/kdump
  register: kdump_installed

- name: Disable kdump service
  ansible.builtin.service:
    name: kdump
    state: stopped
    enabled: false
  when: kdump_installed.stat.exists

- name: Remove anaconda-ks.cfg
  ansible.builtin.file:
    path: /root/anaconda-ks.cfg
    state: absent

- name: Disable services that fail for lxc containers
  ansible.builtin.systemd:
    name: "{{ item }}"
    enabled: false
    state: stopped
  when: ansible_facts['virtualization_role'] == 'guest' and ansible_facts['virtualization_type'] == 'lxc'
  with_items:
    - sys-kernel-config.mount
    - sys-kernel-debug.mount
