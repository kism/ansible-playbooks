# yamllint disable rule:line-length

- name: Copy repo file to yum.repos.d
  ansible.builtin.copy:
    src: repos_dnf/grafana.repo
    dest: /etc/yum.repos.d/grafana.repo
    owner: root
    group: root
    mode: "0644"

# - name: Import Grafana GPG key
#   ansible.builtin.rpm_key:
#     state: present
#     key: https://rpm.grafana.com/gpg.key

- name: Install Grafana
  ansible.builtin.dnf:
    name: grafana
    state: present

- name: Start and enable Grafana service
  ansible.builtin.systemd:
    name: grafana-server
    enabled: true
    state: started

- name: Allow Grafana and nginx through firewalld
  ansible.posix.firewalld:
    service: "{{ item }}"
    zone: public
    permanent: true
    state: enabled
  loop:
    - https
    - http
    - grafana
  notify:
    - Restart firewalld
