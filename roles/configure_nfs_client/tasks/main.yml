---
- name: Install NFS server apt
  ansible.builtin.apt:
    name: nfs-common
    state: present
  when: ansible_pkg_mgr == 'apt'

- name: Install NFS server dnf
  ansible.builtin.dnf:
    name: nfs-utils
    state: present
  when: ansible_pkg_mgr == 'dnf'

- name: Include vars for host
  ansible.builtin.include_vars:
    dir: "vars/{{ ansible_hostname }}.yml"

- name: Create directories
  ansible.builtin.file:
    path: "/mnt/{{ item }}"
    state: directory
    owner: nobody
    group: nogroup
    mode: "0655"
  loop: "{{ configure_nfs_client_mounts }}"

- name: Mount Partitions
  ansible.posix.mount:
    path: "/mnt/{{ item }}"
    src: "{{ configure_nfs_client_remote }}"
    fstype: nfs
    opts: "vers=3,tcp,rsize=32768,wsize=32768,timeo=10,soft,intr"
    state: mounted
  loop: "{{ configure_nfs_client_mounts }}"
